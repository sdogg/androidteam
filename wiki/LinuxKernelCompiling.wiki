#labels Kernel,Makefile
#based on v2.6.26 kernel
= Linux内核Makefile编译生成内核目标文件的过程 =

直接执行make的编译过程
 * 1.先找到入口点([LinuxKernelMakefileStartPoint 入口点问题])
{{{
#编译内核line502,直接执行make默认编译此项
all: vmlinux  
#编译模块line1037,选择编译模块的话会到这里,另外还有其他许多all:target存在,为什么默认执行all: vmlinux ?
all: modules
}}}
 * 2.继续找vmlinux目标
{{{
# vmlinux image - including updated kernel symbols
# vmlinux目标在line806
vmlinux: $(vmlinux-lds) $(vmlinux-init) $(vmlinux-main) vmlinux.o $(kallsyms.o) FORCE
# FORCE是伪目标，make假定伪目标的时间戳总是最新的，即总是被修改过，因此以它为“依赖”的“目标”“vmlinux”在每次make的时候都会被编译。
}}}
 * 3.理解$(vmlinux-lds) $(vmlinux-init) $(vmlinux-main)这个变量的作用
{{{
# line656
vmlinux-init := $(head-y) $(init-y)
# -y是指配置为yes表示加入内核，-m是指配置为module，-n是指配置为no表示不加入内核
vmlinux-main := $(core-y) $(libs-y) $(drivers-y) $(net-y)
vmlinux-all  := $(vmlinux-init) $(vmlinux-main)
vmlinux-lds  := arch/$(SRCARCH)/kernel/vmlinux.lds # SRCARCH为体系结构名,这里我们使用x86
}}}
生成的vmlinux.lds目标文件是链接生成vmlinux映像的[LinkerDescrpitonScript 链接描述文件ld script],从该文件中我们大致可以知道vmlinux映像的头部是$(head-y) $(init-y),vmlinux映像的主体部分是$(core-y) $(libs-y) $(drivers-y) $(net-y)等.具体我们可以仔细研究[LDScrpitKernelI386 ld script to make i386 Linux kernel].
 * 找出$(head-y) $(init-y)包含那些文件
{{{
# line452
init-y		:= init/
# line621
init-y		:= $(patsubst %/, %/built-in.o, $(init-y)) ## 表示将$(init-y)列表中"/"替换为"%/built-in.o",也就是最终init-y == init/built-in.o
}}}

= References =
 * [LinuxMakefileAnalysis Linux内核源代码中的Makefile分析] 
 * /Documentation/kbuild/makefiles.txt - This document describes the Linux kernel Makefiles.[http://hi.baidu.com/wjq_qust/blog/item/97ddbdfdfb2e541309244d30.html 中文译稿]
 * [LinuxKernelConfig 配置内核过程]
 * [LinuxKernelMakefileStartPoint 入口点的问题]
 * [LinuxKernelCompiling 编译生成内核目标文件的过程]