#Ext2FileSystem

# Ext2 File System #

## 创建一个ext2文件系统 ##
在磁盘上创建文件系统通常有两个步骤：
  * 格式化磁盘,Linux中使用命令：superformat或者fdformat
  * 创建文件系统，Ext2：mke2fs
    * mke2fs的缺省参数
      * 磁盘块大小：1024字节
      * 分片：目前不支持，因此与磁盘块一样
      * 分配inode的个数：1/8192B
      * 永久保留的块的个数：5％

创建文件系统的流程：
  * 初始化超级块和组描述符
  * Optionally, 检查是否有坏块，若有创建坏块列表
  * 对每个块组，保留所有用来存放超级块、组描述符、inode表、2个位图的磁盘块
  * 初始化每个块组中的位图
  * 初始化每个块组中的inode表
  * 创建 /root 目录
  * 创建 lost+found 目录（供e2fsck 使用，与坏块相关）
  * 为上述两个目录而更新位图信息
  * 若有坏块，则将其在 lost+found 目录中组织起来
## 管理ext2的磁盘空间 ##
存储在磁盘上的文件与用户所“看到”的文件有所不同：
  * 用户感觉，文件在逻辑上是连续的;而在磁盘上，存储文件数据的磁盘块可能分散在磁盘各处
  * 用户感觉，文件可能比较大;而在磁盘上，由于文件空洞的存在，分配给文件的磁盘空间可能小于用户感觉到的文件大小。

关于数据块的寻址:
  * 任何一个常规文件都会包含一系列数据块
  * 文件内块号 vs. 逻辑块号
    * 根据数据在文件中的偏移可以计算逻辑块号：
      * 首先计算出文件内块号 ＝（偏移f－1）/块大小的商 ＋1
      * 根据索引信息，查询到逻辑块号